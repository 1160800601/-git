"use strict";function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var _extends_1=createCommonjsModule(function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},e.apply(this,arguments)}t.exports=e}),perfData=window.performance&&window.performance.timing||{},responseStart=(new Date).getTime(),processId=(new Date).getTime(),consumers=[],extConsumers=[],currentStatus={status:"init"},validParams=["wpisrc","wpmk","clsrd","tid"],env="prod",cookieDomain=".washingtonpost.com",oneHourMillis=36e5,synchCookies=[{name:"wapo_login_id",expireOffsetMillis:oneHourMillis,cookiesToLocalStorage:!1,localStorageToCookies:!0},{name:"wapo_secure_login_id",expireOffsetMillis:oneHourMillis,cookiesToLocalStorage:!1,localStorageToCookies:!0}];function getUrlVars(){var n={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,o){0<=validParams.indexOf(e)&&(n[e]=o)});return n}function init(){window.pwapiStart=responseStart-(perfData.navigationStart||0),-1!=window.location.hostname.indexOf("impact.")||-1!=window.location.hostname.indexOf("vforum-stage.")?env="stage":-1!=window.location.hostname.indexOf("digitalink.com")&&(env="qa"),initPropensity(),getPwapi(),synchCookiesAndLocalStorage()}function buildQueryParams(){var t={referrer:document.referrer};t.pwapi_contentsection=getContentSection(),t.pwapi_ct_tags=getContentTags(),t.pwapi_sct_tags=getSubscriberOnlyTags(),t.commercial_node=getCommercialNode(),t.content_type=getContentType(),t.is_amp="0",t.as_json="1",_extends_1(t,getUrlVars());var e="";for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];"string"==typeof n&&""!=n&&(e+=o+"="+encodeURIComponent(n.trim())+"&")}return e}function getPwapiUrl(){var t={prod:"https://www.washingtonpost.com/pwapi-proxy/pwproxy",stage:"https://pwapiproxy-stage.washingtonpost.com/pwproxy",qa:"https://testpwapi-proxy.digitalink.com/pwproxy"},e=document.cookie.match(/wp_pwapi=([^\;]*);/)||{};return(t[env=e[1]||env]||t.prod)+window.location.pathname+"?"+buildQueryParams()}function getPwapi(o){o=o||!1;var t="function"==typeof fetch,e=getPwapiUrl();try{if(!o||o&&!t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.timeout=15e3,n.withCredentials=!0,n.onload=function(){if(window.pwapiResponse=(new Date).getTime()-responseStart,window.pwapiAPIEnd=(new Date).getTime()-(perfData.navigationStart||0),4===this.readyState&&200==this.status){var t={};try{(t=JSON.parse(this.response)).statusCode=200,handlePwapiResponse(t)}catch(t){handlePwapiError({statusCode:t.statusCode=-1,msg:"pwapiproxy response invalid"+(t.statusText?" - "+t.statusText:"")})}}else{ex.statusCode=-1,handlePwapiError({statusCode:this.status,msg:"pwapiproxy response invalid"})}},n.onerror=function(t){window.pwapiAPIEnd=(new Date).getTime()-(perfData.navigationStart||0);var e={statusCode:t&&t.statusCode?t.statusCode:500};o?(e.msg="pwapiproxy retry error",handlePwapiError(e)):(e.msg="pwapiproxy error",handlePwapiError(e),getPwapi(!0))},n.ontimeout=function(){var t={statusCode:504,timeout:((new Date).getTime()-responseStart)/1e3,msg:"PWAPIPROXY TIMEOUT"};o?handlePwapiError(t):(handlePwapiError(t),getPwapi(!0))},window.pwapiAPIStart=(new Date).getTime()-(perfData.navigationStart||0),n.send()}else fetch(e,{credentials:"include"}).finally(function(t){if(t&&t.ok)handlePwapiResponse(t.json());else{console.log("Pwapiproxy retry error");handlePwapiError({statusCode:500,msg:"pwapiproxy retry error"})}})}catch(t){var a={statusCode:500};o?(a.msg="pwapiproxy error"+(t.message?" - "+t.message:""),handlePwapiError(a)):(a.msg="pwapiproxy error"+(t.message?" - "+t.message:""),handlePwapiError(a),getPwapi(!0))}}function handlePwapiError(t){t=t||{},console.log("errorCode:",t.statusCode),updateStatus({status:"error"});var e={process:"pwapiproxy-response",xhrstatus:t.statusCode};t.timeout&&(e.timeout=t.timeout),logging("error",t.msg,e)}function handlePwapiResponse(t){t.status="processing",window.pwapiPaywallStatus=200,isSponsoredContent()?(t.status="final",t.action=t.data.action=0):1==t.data.sgn&&isBTWContent()?(t.status="final",t.action=t.data.action=0):0<t.data.action?checkSWG():t.status="final",updateStatus(t)}function isSponsoredContent(){var t=localStorage.getItem("wp_sponsored");if(-1<window.location.search.indexOf("das=pw_spsrd_hit")||-1<window.location.search.indexOf("pw_unlock_mgclink")){if(localStorage.setItem("wp_sponsored",window.location.pathname),"function"==typeof history.replaceState){var e=window.location.href;e=e.replace(/das\=[^\&]*/,""),history.replaceState({},null,e)}return!0}return!(!t||window.location.pathname!=t)}function isBTWContent(){return 0===window.location.pathname.indexOf("/travel/")}function getCookie(t){if(!t)return null;if(!document.cookie)return null;for(var e={},o=null,n=document.cookie.split(";"),a=0;a<n.length;a++)if(0<n[a].indexOf("=")){var i=n[a].split("="),r=i[0],s=i[1];(r=r&&r.trim())===t&&(o=(s=s||"").trim()),e[r]=s.trim()}return o}function synchCookiesAndLocalStorage(){for(var t={},e={},o=0;o<synchCookies.length;o++){var n=synchCookies[o];try{var a=n.name,i=(n.expireOffsetMillis,getCookie(a)),r=localStorage.getItem(a),s=null;r&&(s=JSON.parse(r)).e<(new Date).getTime()&&(s=null,localStorage.removeItem(a)),null==s||null!=i||!n.localStorageToCookies||(storeCookies(a,s.v,s.e,n.notEncoded),e[a]=s.v)}catch(t){console.error("Unable to synchCookiesAndLocalStorage for synchCookie item: "+JSON.stringify(n),t)}}try{(0<Object.keys(e).length||0<Object.keys(t).length)&&logging("info","User storage Synced",{process:"storage-sync","cookie-sync":JSON.stringify(t),"ls-sync":JSON.stringify(e)})}catch(t){}}function storeCookies(t,e,o,n,a){var i="",r="",s=!1===a?"":";secure";if(o<0?i=";expires="+new Date(1e3).toUTCString:0<o&&(i=";expires="+new Date(o).toUTCString()),"qa"===env&&(cookieDomain=".digitalink.com"),null!=cookieDomain&&(r=";domain="+cookieDomain),e=e||"",n)var p=e;else p=encodeURIComponent(e);var c=t+"="+p+";path=/"+i+r+s;document.cookie=c}function checkSWG(){startSwgScript(),checkGoogleUserEntitlements(),setTimeout(function(){"final"!==currentStatus.status&&updateStatus({status:"final"})},5e3)}function updateStatus(t){window.pwapiPaywallResponse=currentStatus=_extends_1(currentStatus,t);for(var e=0;e<extConsumers.length;e++)extConsumers[e](currentStatus);for(e=0;e<consumers.length;e++)consumers[e](currentStatus)}function startSwgScript(){var t=document.createElement("script");t.type="text/javascript",t.setAttribute("subscriptions-control","manual"),t.src="https://news.google.com/swg/js/v1/swg.js",t.onerror=function(){},document.head.appendChild(t)}function checkGoogleUserEntitlements(){(self.SUBSCRIPTIONS=self.SUBSCRIPTIONS||[]).push(function(t){t.init("washingtonpost.com:basic"),t.getEntitlements().then(function(t){t&&t.entitlements&&0<t.entitlements.length?updateStatus({action:0,data:{action:0},status:"final"}):updateStatus({status:"final"})})})}function getObjectValue(t,e){for(var o=e.split("."),n=0,a=o.length;null!=t&&n<a;){t=t[o[n++]]}return n&&n==a?t:void 0}function logging(t,e,o){var n;switch(o=o||{},e=e||"",t){case"info":n="logInfo";break;case"success":n="logSuccess";break;case"error":n="logHandledError";break;default:n="logInfo"}var a="https://www.washingtonpost.com/subscribe/logging/";-1!==window.location.hostname.indexOf(".digitalink.com")?a="https://subscribe.digitalink.com/logging/":-1===window.location.hostname.indexOf("pb-impact")&&-1===window.location.hostname.indexOf("impact.washpost")||(a="https://pb-impact.washingtonpost.com/subscribe/logging/");try{var i=new XMLHttpRequest;i.open("POST",a+n,!0),i.setRequestHeader("Content-Type","application/json"),o.processId=processId,o.path=window.location.pathname;var r={appName:"site-paywall",locationId:"pwapi-proxy",message:e,state:o};i.withCredentials=!0,i.send(JSON.stringify(r)),i.onload=function(){},i.onerror=function(){}}catch(t){console.error("LOGGING ERROR")}}window.registerPwapiConsumer=function(t){consumers.push(t),t(currentStatus)},window.registerExtUpdates=function(t){extConsumers.push(t),t(currentStatus)},window.extListener=function(t){updateStatus(t)};var getContentSection=function(){return window.wp_section||getObjectValue(window.TWP,"Data.Tracking.props.section")},getContentTags=function(){return getObjectValue(window.wp_meta_data,"tags_for_paywall")},getSubscriberOnlyTags=function(){return getObjectValue(window.wp_meta_data,"tags_for_paywall_subs")},getCommercialNode=function(){return getObjectValue(window.TWP,"Data.Tracking.props.commercial_node")},getContentType=function(){return getObjectValue(window.TWP,"Data.Tracking.props.content_type")},initPropensity=function(){var o=(new Date).getTime(),t=window.localStorage.getItem("wpPropensity"),e={};window.wpMetaData=window.wpMetaData||{};try{e=t?JSON.parse(t):{}}catch(t){}if(void 0!==e.value&&e.expires>o)window.wpMetaData.wpPropensity=e.value;else{var n=document.cookie.match(/wapo_login_id=([^\;]*);/),a=!!n&&n[1],i=document.cookie.match(/s_vi=([^\|]*)\|([^\;]*)\[([^\;]*);/),r=!!i&&i[2];if(r||a){var s="https://propensity.perso.washpost.io/api/v1/propensity?omniture_id="+r+"&login_id="+a,p=new XMLHttpRequest;p.open("GET",s,!0),p.timeout=2e3,p.onload=function(){if(4===this.readyState&&200==this.status)try{var t=JSON.parse(this.response)||{};window.wpMetaData.wpPropensity=t.value;var e=o+36e5;window.localStorage.setItem("wpPropensity",JSON.stringify({value:t.value,expires:e}))}catch(t){}},p.send()}}};init();
